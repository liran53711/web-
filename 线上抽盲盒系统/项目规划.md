# çº¿ä¸ŠæŠ½ç›²ç›’ç³»ç»Ÿ - é¡¹ç›®è§„åˆ’

## ğŸ“ æ–‡ä»¶ç»“æ„

### ğŸ“ æœ¬åœ°å¼€å‘ç‰ˆæœ¬ç»“æ„
```
çº¿ä¸ŠæŠ½ç›²ç›’ç³»ç»Ÿ/
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html          # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ style.css           # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ blindbox.js     # æŠ½ç›²ç›’æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ animation.js    # åŠ¨ç”»æ•ˆæœ
â”‚   â”‚   â”œâ”€â”€ user.js         # ç”¨æˆ·ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ friends.js      # å¥½å‹ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ gifts.js        # èµ äºˆç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ api.js          # APIè¯·æ±‚å°è£…
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ images/         # å•†å“å›¾ç‰‡
â”‚       â””â”€â”€ sounds/         # éŸ³æ•ˆæ–‡ä»¶
â”œâ”€â”€ backend/                # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ server.js           # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js     # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ jwt.js          # JWTé…ç½®
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js         # ç”¨æˆ·è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ blindbox.js     # ç›²ç›’ç›¸å…³è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ friends.js      # å¥½å‹ç³»ç»Ÿè·¯ç”±
â”‚   â”‚   â””â”€â”€ gifts.js        # èµ äºˆç³»ç»Ÿè·¯ç”±
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.js         # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Product.js      # å•†å“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Friendship.js   # å¥½å‹å…³ç³»æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Gift.js         # èµ äºˆè®°å½•æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js         # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ validation.js   # æ•°æ®éªŒè¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ probability.js  # æ¦‚ç‡è®¡ç®—å·¥å…·
â”‚       â””â”€â”€ socket.js       # Socket.ioå¤„ç†
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.sql          # æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ seed.sql            # åˆå§‹æ•°æ®
â”œâ”€â”€ package.json            # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡
â””â”€â”€ é¡¹ç›®è§„åˆ’.md             # æœ¬æ–‡ä»¶
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·ç³»ç»Ÿ (user.js)
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [ ] ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- [ ] èƒŒåŒ…ç³»ç»Ÿ
- [ ] é‡‘å¸/ç§¯åˆ†ç³»ç»Ÿ
- [ ] å¥½å‹ç³»ç»Ÿ
- [ ] å¥½å‹èµ äºˆåŠŸèƒ½

### 2. å•†å“ç³»ç»Ÿ (products.json)
- [ ] ç›²ç›’å•†å“å®šä¹‰
- [ ] ç¨€æœ‰åº¦ç­‰çº§è®¾ç½®
- [ ] ä»·æ ¼ä½“ç³»
- [ ] å•†å“å›¾ç‰‡ç®¡ç†

### 3. æŠ½å¥–é€»è¾‘ (blindbox.js)
- [ ] æ¦‚ç‡è®¡ç®—ç®—æ³•
- [ ] éšæœºæŠ½å–é€»è¾‘
- [ ] é˜²é‡å¤æœºåˆ¶
- [ ] ç¨€æœ‰åº¦æƒé‡ç³»ç»Ÿ

### 4. åŠ¨ç”»æ•ˆæœ (animation.js)
- [ ] å¼€ç®±åŠ¨ç”»
- [ ] ç‰©å“å±•ç¤ºåŠ¨ç”»
- [ ] è·å¾—ç¨€æœ‰ç‰©å“ç‰¹æ•ˆ
- [ ] é¡µé¢åˆ‡æ¢åŠ¨ç”»

### 5. ç•Œé¢è®¾è®¡ (index.html + style.css)
- [ ] ä¸»é¡µå¸ƒå±€
- [ ] ç›²ç›’å•†åº—ç•Œé¢
- [ ] ç”¨æˆ·èƒŒåŒ…ç•Œé¢
- [ ] å“åº”å¼è®¾è®¡

## ğŸ“Š æ•°æ®ç»“æ„è®¾è®¡

### å•†å“æ•°æ®ç»“æ„ (products.json)
```json
{
  "blindBoxes": [
    {
      "id": 1,
      "name": "ç»å…¸ç›²ç›’",
      "price": 100,
      "image": "classic_box.png",
      "items": [
        {
          "id": 1,
          "name": "æ™®é€šç‰©å“",
          "rarity": "common",
          "probability": 60,
          "image": "item1.png"
        }
      ]
    }
  ]
}
```

### ç”¨æˆ·æ•°æ®ç»“æ„ (users.json)
```json
{
  "users": [
    {
      "id": 1,
      "username": "player1",
      "coins": 1000,
      "level": 5,
      "avatar": "avatar1.png",
      "lastLogin": "2024-01-01T10:00:00Z",
      "inventory": [
        {
          "itemId": 1,
          "quantity": 2,
          "obtainedAt": "2024-01-01",
          "canGift": true
        }
      ]
    }
  ]
}
```

### å¥½å‹å…³ç³»æ•°æ®ç»“æ„ (friends.json)
```json
{
  "friendships": [
    {
      "id": 1,
      "userId": 1,
      "friendId": 2,
      "status": "accepted",
      "createdAt": "2024-01-01T10:00:00Z",
      "friendshipLevel": 3
    }
  ],
  "friendRequests": [
    {
      "id": 1,
      "fromUserId": 1,
      "toUserId": 3,
      "status": "pending",
      "sentAt": "2024-01-01T11:00:00Z",
      "message": "ä¸€èµ·ç©ç›²ç›’å§ï¼"
    }
  ]
}
```

### èµ äºˆè®°å½•æ•°æ®ç»“æ„ (gifts.json)
```json
{
  "gifts": [
    {
      "id": 1,
      "fromUserId": 1,
      "toUserId": 2,
      "itemId": 5,
      "quantity": 1,
      "message": "æ­å–œä½ å‡çº§ï¼",
      "status": "pending",
      "sentAt": "2024-01-01T12:00:00Z",
      "receivedAt": null,
      "giftType": "item"
    },
    {
      "id": 2,
      "fromUserId": 2,
      "toUserId": 1,
      "coins": 100,
      "message": "è°¢è°¢ä½ çš„å¸®åŠ©ï¼",
      "status": "received",
      "sentAt": "2024-01-01T13:00:00Z",
      "receivedAt": "2024-01-01T13:30:00Z",
      "giftType": "coins"
    }
  ]
}
```

## ğŸ® å¼€å‘é¡ºåºå»ºè®®

1. **é˜¶æ®µä¸€ï¼šåŸºç¡€æ¡†æ¶**
   - åˆ›å»º index.html åŸºç¡€é¡µé¢
   - è®¾è®¡ style.css åŸºæœ¬æ ·å¼
   - å®ç°ç®€å•çš„ç”¨æˆ·ç•Œé¢

2. **é˜¶æ®µäºŒï¼šæ ¸å¿ƒé€»è¾‘**
   - å®ç° blindbox.js æŠ½å¥–ç®—æ³•
   - åˆ›å»º products.json å•†å“æ•°æ®
   - åŸºç¡€çš„æŠ½ç›²ç›’åŠŸèƒ½

3. **é˜¶æ®µä¸‰ï¼šç”¨æˆ·ç³»ç»Ÿ**
   - å®ç° user.js ç”¨æˆ·ç®¡ç†
   - æ·»åŠ ç™»å½•æ³¨å†ŒåŠŸèƒ½
   - èƒŒåŒ…ç³»ç»Ÿå¼€å‘

4. **é˜¶æ®µå››ï¼šåŠ¨ç”»ä¼˜åŒ–**
   - å®ç° animation.js åŠ¨ç”»æ•ˆæœ
   - ç¾åŒ–ç”¨æˆ·ç•Œé¢
   - æ·»åŠ éŸ³æ•ˆæ”¯æŒ

5. **é˜¶æ®µäº”ï¼šå¥½å‹èµ äºˆç³»ç»Ÿ**
   - å®ç° friends.js å¥½å‹ç®¡ç†
   - å®ç° gifts.js èµ äºˆåŠŸèƒ½
   - å¥½å‹ç•Œé¢å’Œèµ äºˆç•Œé¢å¼€å‘
   - èµ äºˆé™åˆ¶å’Œå®‰å…¨æœºåˆ¶

6. **é˜¶æ®µå…­ï¼šçº¿ä¸Šéƒ¨ç½²**
   - æœåŠ¡å™¨ç¯å¢ƒæ­å»º
   - æ•°æ®åº“éƒ¨ç½²å’Œé…ç½®
   - åŸŸåç»‘å®šå’ŒSSLè¯ä¹¦
   - æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

7. **é˜¶æ®µä¸ƒï¼šå®Œå–„åŠŸèƒ½**
   - åº“å­˜ç®¡ç†ç³»ç»Ÿ
   - æ•°æ®æŒä¹…åŒ–
   - é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
   - ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–

## ğŸ¨ ç¨€æœ‰åº¦ç³»ç»Ÿ

| ç¨€æœ‰åº¦ | æ¦‚ç‡ | é¢œè‰²æ ‡è¯† | ç‰¹æ•ˆ |
|--------|------|----------|------|
| æ™®é€š (Common) | 60% | ç°è‰² | æ—  |
| ç¨€æœ‰ (Rare) | 25% | è“è‰² | è“å…‰ |
| å²è¯— (Epic) | 10% | ç´«è‰² | ç´«å…‰+éŸ³æ•ˆ |
| ä¼ è¯´ (Legendary) | 4% | æ©™è‰² | é‡‘å…‰+ç‰¹æ®ŠéŸ³æ•ˆ |
| ç¥è¯ (Mythic) | 1% | çº¢è‰² | å½©è™¹ç‰¹æ•ˆ |

## ğŸ“ æŠ€æœ¯è¦æ±‚

### å‰ç«¯æŠ€æœ¯æ ˆ
- **å‰ç«¯æŠ€æœ¯**ï¼šHTML5, CSS3, JavaScript (ES6+)
- **åŠ¨ç”»åº“**ï¼šåŸç”ŸCSSåŠ¨ç”» æˆ– ç®€å•JavaScriptåŠ¨ç”»
- **å“åº”å¼**ï¼šæ”¯æŒæ‰‹æœºå’Œæ¡Œé¢ç«¯
- **HTTPè¯·æ±‚**ï¼šFetch API æˆ– Axios

### åç«¯æŠ€æœ¯æ ˆï¼ˆçº¿ä¸Šç‰ˆæœ¬ï¼‰
- **æœåŠ¡å™¨**ï¼šNode.js + Express.js
- **æ•°æ®åº“**ï¼šMySQL æˆ– MongoDB
- **ç”¨æˆ·è®¤è¯**ï¼šJWT (JSON Web Token)
- **å®æ—¶é€šä¿¡**ï¼šSocket.ioï¼ˆå¥½å‹åœ¨çº¿çŠ¶æ€ã€å®æ—¶é€šçŸ¥ï¼‰
- **æ–‡ä»¶å­˜å‚¨**ï¼šæœ¬åœ°å­˜å‚¨ æˆ– äº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘OSS/è…¾è®¯äº‘COSï¼‰

### éƒ¨ç½²æ–¹æ¡ˆ
- **æœåŠ¡å™¨**ï¼šäº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ECS/è…¾è®¯äº‘CVMï¼‰
- **åŸŸå**ï¼šæ³¨å†ŒåŸŸå + SSLè¯ä¹¦
- **CDN**ï¼šé™æ€èµ„æºåŠ é€Ÿ
- **æ•°æ®åº“**ï¼šäº‘æ•°æ®åº“RDS

## ğŸ‘¥ å¥½å‹èµ äºˆç³»ç»Ÿ

### 6. å¥½å‹ç³»ç»Ÿ (friends.js)
- [ ] å¥½å‹æœç´¢ï¼ˆç”¨æˆ·å/IDï¼‰
- [ ] å‘é€å¥½å‹è¯·æ±‚
- [ ] æ¥å—/æ‹’ç»å¥½å‹è¯·æ±‚
- [ ] å¥½å‹åˆ—è¡¨ç®¡ç†
- [ ] å¥½å‹ç­‰çº§ç³»ç»Ÿ
- [ ] åœ¨çº¿çŠ¶æ€æ˜¾ç¤º

### 7. èµ äºˆç³»ç»Ÿ (gifts.js)
- [ ] ç‰©å“èµ äºˆåŠŸèƒ½
- [ ] é‡‘å¸èµ äºˆåŠŸèƒ½
- [ ] èµ äºˆæ¶ˆæ¯ç³»ç»Ÿ
- [ ] ç¤¼ç‰©æ¥æ”¶ç¡®è®¤
- [ ] èµ äºˆå†å²è®°å½•
- [ ] èµ äºˆé™åˆ¶æœºåˆ¶

### ğŸ èµ äºˆåŠŸèƒ½è®¾è®¡

#### èµ äºˆç±»å‹
1. **ç‰©å“èµ äºˆ**
   - èƒŒåŒ…ä¸­çš„æ™®é€š-å²è¯—çº§ç‰©å“å¯èµ äºˆ
   - ä¼ è¯´çº§ä»¥ä¸Šç‰©å“ä¸å¯èµ äºˆï¼ˆä¿æŒç¨€æœ‰æ€§ï¼‰
   - æ¯ä¸ªç‰©å“æ ‡è®°`canGift`å±æ€§

2. **é‡‘å¸èµ äºˆ**
   - æ¯æ—¥èµ äºˆé‡‘å¸ä¸Šé™ï¼š1000æš
   - å¥½å‹ç­‰çº§è¶Šé«˜ï¼Œèµ äºˆä¸Šé™è¶Šé«˜
   - èµ äºˆæ‰‹ç»­è´¹ï¼š5%ï¼ˆé˜²æ­¢åˆ·é‡‘å¸ï¼‰

3. **ç‰¹æ®Šç¤¼å“**
   - èŠ‚æ—¥é™å®šç¤¼å“ç›’
   - ç”Ÿæ—¥ç¥ç¦ç¤¼åŒ…
   - æˆå°±åº†ç¥ç¤¼å“

#### èµ äºˆé™åˆ¶è§„åˆ™
- æ–°æ³¨å†Œç”¨æˆ·7å¤©å†…ä¸èƒ½èµ äºˆ
- å¥½å‹å…³ç³»éœ€è¦ç»´æŒ3å¤©ä»¥ä¸Šæ‰èƒ½èµ äºˆ
- æ¯æ—¥èµ äºˆæ¬¡æ•°é™åˆ¶ï¼š10æ¬¡
- åŒä¸€å¥½å‹æ¯æ—¥æœ€å¤šæ¥æ”¶3ä»½ç¤¼ç‰©

#### ç•Œé¢åŠŸèƒ½
- å¥½å‹åˆ—è¡¨é¡µé¢
- èµ äºˆç‰©å“é€‰æ‹©ç•Œé¢
- ç¤¼ç‰©ç®±ï¼ˆæ¥æ”¶ç¤¼ç‰©ï¼‰
- èµ äºˆå†å²æŸ¥çœ‹
- å¥½å‹åŠ¨æ€æé†’

### ğŸ”§ å¥½å‹èµ äºˆAPIè®¾è®¡

#### å¥½å‹ç³»ç»Ÿå‡½æ•° (friends.js)
```javascript
// æœç´¢ç”¨æˆ·
searchUser(username)

// å‘é€å¥½å‹è¯·æ±‚
sendFriendRequest(fromUserId, toUserId, message)

// å¤„ç†å¥½å‹è¯·æ±‚
handleFriendRequest(requestId, action) // action: 'accept'/'reject'

// è·å–å¥½å‹åˆ—è¡¨
getFriendsList(userId)

// è·å–å¥½å‹è¯·æ±‚åˆ—è¡¨
getFriendRequests(userId)

// åˆ é™¤å¥½å‹
removeFriend(userId, friendId)
```

#### èµ äºˆç³»ç»Ÿå‡½æ•° (gifts.js)
```javascript
// å‘é€ç‰©å“ç¤¼ç‰©
sendItemGift(fromUserId, toUserId, itemId, quantity, message)

// å‘é€é‡‘å¸ç¤¼ç‰©
sendCoinsGift(fromUserId, toUserId, amount, message)

// æ¥æ”¶ç¤¼ç‰©
receiveGift(giftId, userId)

// è·å–å¾…æ¥æ”¶ç¤¼ç‰©
getPendingGifts(userId)

// è·å–èµ äºˆå†å²
getGiftHistory(userId, type) // type: 'sent'/'received'

// æ£€æŸ¥èµ äºˆé™åˆ¶
checkGiftLimits(fromUserId, toUserId, giftType)
```

## ğŸŒ çº¿ä¸ŠåŠŸèƒ½å®ç°æ–¹æ¡ˆ

### ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡ (MySQL)

#### ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE,
    coins INT DEFAULT 1000,
    level INT DEFAULT 1,
    avatar VARCHAR(255) DEFAULT 'default.png',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    is_online BOOLEAN DEFAULT FALSE,
    daily_gift_count INT DEFAULT 0,
    last_gift_reset DATE
);
```

#### å•†å“è¡¨ (products)
```sql
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    rarity ENUM('common', 'rare', 'epic', 'legendary', 'mythic'),
    probability DECIMAL(5,2),
    image VARCHAR(255),
    can_gift BOOLEAN DEFAULT TRUE,
    blindbox_id INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ç”¨æˆ·åº“å­˜è¡¨ (user_inventory)
```sql
CREATE TABLE user_inventory (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    product_id INT,
    quantity INT DEFAULT 1,
    obtained_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

#### å¥½å‹å…³ç³»è¡¨ (friendships)
```sql
CREATE TABLE friendships (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    friend_id INT,
    status ENUM('pending', 'accepted', 'rejected') DEFAULT 'pending',
    friendship_level INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (friend_id) REFERENCES users(id)
);
```

#### èµ äºˆè®°å½•è¡¨ (gifts)
```sql
CREATE TABLE gifts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    from_user_id INT,
    to_user_id INT,
    gift_type ENUM('item', 'coins'),
    product_id INT NULL,
    coins_amount INT NULL,
    quantity INT DEFAULT 1,
    message TEXT,
    status ENUM('pending', 'received', 'expired') DEFAULT 'pending',
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    received_at TIMESTAMP NULL,
    FOREIGN KEY (from_user_id) REFERENCES users(id),
    FOREIGN KEY (to_user_id) REFERENCES users(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

### ğŸ”— RESTful API æ¥å£è®¾è®¡

#### ç”¨æˆ·è®¤è¯ API
```javascript
POST /api/auth/register     // ç”¨æˆ·æ³¨å†Œ
POST /api/auth/login        // ç”¨æˆ·ç™»å½•
POST /api/auth/logout       // ç”¨æˆ·ç™»å‡º
GET  /api/auth/profile      // è·å–ç”¨æˆ·ä¿¡æ¯
PUT  /api/auth/profile      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```

#### ç›²ç›’ç³»ç»Ÿ API
```javascript
GET  /api/blindbox/list     // è·å–ç›²ç›’åˆ—è¡¨
POST /api/blindbox/open     // å¼€å¯ç›²ç›’
GET  /api/inventory         // è·å–ç”¨æˆ·èƒŒåŒ…
GET  /api/products          // è·å–å•†å“åˆ—è¡¨
```

#### å¥½å‹ç³»ç»Ÿ API
```javascript
GET  /api/friends           // è·å–å¥½å‹åˆ—è¡¨
POST /api/friends/search    // æœç´¢ç”¨æˆ·
POST /api/friends/request   // å‘é€å¥½å‹è¯·æ±‚
PUT  /api/friends/request/:id // å¤„ç†å¥½å‹è¯·æ±‚
DELETE /api/friends/:id     // åˆ é™¤å¥½å‹
GET  /api/friends/requests  // è·å–å¥½å‹è¯·æ±‚åˆ—è¡¨
```

#### èµ äºˆç³»ç»Ÿ API
```javascript
POST /api/gifts/send        // å‘é€ç¤¼ç‰©
GET  /api/gifts/pending     // è·å–å¾…æ¥æ”¶ç¤¼ç‰©
PUT  /api/gifts/:id/receive // æ¥æ”¶ç¤¼ç‰©
GET  /api/gifts/history     // è·å–èµ äºˆå†å²
GET  /api/gifts/limits      // æ£€æŸ¥èµ äºˆé™åˆ¶
```

### âš¡ å®æ—¶é€šä¿¡ (Socket.io)

#### è¿æ¥äº‹ä»¶
```javascript
// ç”¨æˆ·ä¸Šçº¿
socket.on('user_online', (userId) => {
    updateUserStatus(userId, true);
    notifyFriends(userId, 'online');
});

// ç”¨æˆ·ä¸‹çº¿
socket.on('disconnect', () => {
    updateUserStatus(socket.userId, false);
    notifyFriends(socket.userId, 'offline');
});
```

#### å¥½å‹é€šçŸ¥
```javascript
// å¥½å‹è¯·æ±‚é€šçŸ¥
socket.emit('friend_request', {
    from: userData,
    message: 'æƒ³å’Œä½ æˆä¸ºå¥½å‹'
});

// ç¤¼ç‰©æ¥æ”¶é€šçŸ¥
socket.emit('gift_received', {
    from: userData,
    gift: giftData,
    message: 'ä½ æ”¶åˆ°äº†ä¸€ä»½ç¤¼ç‰©ï¼'
});
```

### ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

#### 1. åç«¯ä¾èµ– (package.json)
```json
{
  "name": "blindbox-backend",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.0",
    "mysql2": "^3.0.0",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.0",
    "socket.io": "^4.7.0",
    "cors": "^2.8.5",
    "dotenv": "^16.0.0",
    "multer": "^1.4.5",
    "helmet": "^6.0.0"
  }
}
```

#### 2. ç¯å¢ƒå˜é‡ (.env)
```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=blindbox_db

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=7d

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

#### 3. å¯åŠ¨è„šæœ¬
```json
{
  "scripts": {
    "start": "node backend/server.js",
    "dev": "nodemon backend/server.js",
    "init-db": "mysql -u root -p < database/schema.sql"
  }
}
```

### ğŸš€ éƒ¨ç½²æµç¨‹

#### 1. äº‘æœåŠ¡å™¨å‡†å¤‡
```bash
# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…MySQL
sudo apt update
sudo apt install mysql-server

# å®‰è£…Nginx
sudo apt install nginx
```

#### 2. é¡¹ç›®éƒ¨ç½²
```bash
# å…‹éš†é¡¹ç›®
git clone your-repo.git
cd blindbox-system

# å®‰è£…ä¾èµ–
npm install

# æ•°æ®åº“åˆå§‹åŒ–
mysql -u root -p < database/schema.sql
mysql -u root -p < database/seed.sql

# å¯åŠ¨æœåŠ¡
npm start
```

#### 3. Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        root /path/to/frontend;
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /socket.io {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## ğŸš€ åç»­æ‰©å±•åŠŸèƒ½

- [ ] æ¯æ—¥ç­¾åˆ°ç³»ç»Ÿ
- [ ] æˆå°±ç³»ç»Ÿ
- [ ] äº¤æ˜“å¸‚åœº
- [ ] å…¬ä¼šç³»ç»Ÿ
- [ ] æ’è¡Œæ¦œåŠŸèƒ½
- [ ] å¥½å‹PKå¯¹æˆ˜ 